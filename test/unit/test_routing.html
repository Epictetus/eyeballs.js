<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script src="../../dist/jquery/jquery-1.4.2.min.js"></script>
  <script src="../../dist/jquery/jquery.livequery.js"></script>
  <script src="../../dist/jquery/jquery.ba-hashchange.js"></script>
  <script src="../../src/o_O.js"></script>
  <script src="../../src/modules/o_O.model.js"></script>
  <script src="../../src/modules/o_O.validations.js"></script>
  <script src="../../src/drivers/jquery/adapters/o_O.dom.js"></script>
  <script src="../../src/drivers/jquery/modules/o_O.controller.js"></script>
  <script src="../../src/drivers/jquery/modules/o_O.support.js"></script>
  <script src="../../src/drivers/jquery/modules/o_O.routes.js"></script>

  <link rel="stylesheet" href="qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="qunit.js"></script>

  <script>
  o_O('ReviewsController', {
    root: function(){
      $('div#root').html('rooting for you')
    },
    index: function(bit){
      var out;
      if(bit == 'test')
      {
        out = 'clicked!'
      }
      else
      {
        out = 'indexed!'
      }
      $('div#index').html(out);
      return 'whoop!'
    },
    namespaced_index: function(bit){
      var out;
      if(bit == 'test')
      {
        out = 'namespaced and clicked!'
      }
      else
      {
        out = 'namespaced and indexed!'
      }
      $('div#namespaced-index').html(out);
      return 'awesome!'
    },
    sending_params: function(params){
      $('div#with_params').html(params('test'));
    }
  });
  
  o_O.routes.draw(function(map){
    map.root({to: "reviews#root"})
    map.match('/reviews/index/', {to: "reviews#index", with_args: 'test'});
    map.namespace('my', function(my){
      my.match('action', {to: "reviews#namespaced_index", with_args: 'test'})
    })
    map.match('/reviews/:test', {to: 'reviews#sending_params'})
  })

  $(document).ready(function(){
    
    module("Routing", {teardown: function(){
      document.location.hash = ''
    }});
    
    test('o_O.routes.urls', function(){
      equals(o_O.routes.urls[0], 'reviews/index', 'should store the necessary URLs')
      equals(o_O.routes.urls[1], 'my/action', 'should store the necessary URLs')
    })
    
    test('o_O.routes.rules', function(){
      equals(o_O.routes.rules['reviews/index'].action(), ReviewsController.index())
      equals(o_O.routes.rules['my/action'].action(), ReviewsController.namespaced_index())
    })
    
    test('o_O.routes.root', function(){
      equals($('div#root').html(), 'rooting for you');
    })
    
    asyncTest('map.match',function(){
      $('a#index-link').trigger('click');
      setTimeout(function(){
        equals($('div#index').html(), 'clicked!', "should call the action");
        start();
      },100)
    })
    
    asyncTest('map.namespace',function(){
      $('a#namespaced-index-link').trigger('click');
      setTimeout(function(){
        equals($('div#namespaced-index').html(), 'namespaced and clicked!', "should call the action");
        start();
      },100)
    })
    
    asyncTest('withparams',function(){
      $('a#with-params').trigger('click');
      setTimeout(function(){
        equals($('div#with_params').html(), 'something', "should pass the params");
        start();
      },100)
    })
    

  });
  </script>
  
</head>
<body>
  <h1 id="qunit-header">Controller Tests</h1>
  <h2 id="qunit-banner"></h2>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
 
  <a id="index-link" data-ajax-history="true" href="/reviews/index">Hello!</a>
  <a id="namespaced-index-link" data-ajax-history="true" href="/my/action">Hello!</a>
  
  <a id="with-params" data-ajax-history="true" href="/reviews/something">Hello!</a>
 
  <div id="index">
  </div>
  <div id="namespaced-index">
  </div>
  <div id="root"></div>
  <div id="with_params"></div>
</body>
</html>