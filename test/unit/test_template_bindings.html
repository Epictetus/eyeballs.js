<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script src="../../dist/jquery/jquery-1.6.1.min.js"></script>
  <script src="../../dist/mustache/mustache.0.3.0.js" type="text/javascript"></script> 
  <script src="../../src/o_O.js"></script>
  <script src="../../src/modules/o_O.bucket.js"></script>
  <script src="../../src/modules/o_O.model.js"></script>
  <script src="../../src/modules/o_O.validations.js"></script>
  <script src="../../src/drivers/jquery/adapters/o_O.dom.js"></script>
  <script src="../../src/drivers/jquery/modules/o_O.controller.js"></script>
  <script src="../../src/drivers/jquery/modules/o_O.support.js"></script>
  <script src="/tests.js"></script>
  <script src="run_all.js"></script>

  <link rel="stylesheet" href="qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="qunit.js"></script>

  <script>
  

  $(document).ready(function(){
    
    module("Template Bindings Test",{
      setup: function(){
        localStorage.clear();
        o_O.config.template_path = '/test/support'
      }
    });
    
    o_O.model.adapter = o_O.dom;
    
    asyncTest('renders model that is bound to an element', function() {
      var model = o_O('Post', function() {});
      var post = Post.initialize({title: 'Cat dead', body: "She's totally done. Fo sure."})
      o_O.render('test', post, '#test-container')
      setTimeout(function() {
        equals($('#test-container').text(), "Cat dead: She's totally done. Fo sure.")
        start()
      }, 10)
    });
    
    asyncTest('can modify a bound model', function() {
      var model = o_O('Post', function() {});
      var post = Post.initialize({title: 'Cat dead', body: "She's totally done. Fo sure."})
      o_O.render('test', post, '#test-container')
      post('title', 'Dog dead')
      setTimeout(function() {
        equals($('#test-container').text(), "Dog dead: She's totally done. Fo sure.")
        start()
      }, 10)
    })
    
    asyncTest('renders model bucket that is bound to an element', 1, function() {
      $('#test-ul').html('')
      var model = o_O('Post', function() {});
      var post1 = Post.initialize({title: 'Cat dead', body: "She's totally done. Fo sure."})
      
      var posts = o_O('PostsBucket', [post1])
      o_O.render('test', posts, '#test-ul', '<li/>')
      
      setTimeout(function() {
        equals($('#test-ul').html(), "<li>Cat dead: She's totally done. Fo sure.</li>")
        start()
      }, 100)
    })
    
    asyncTest('can deal with models added to a bound bucket', 1, function() {
      $('#test-ul').html('')
      var model = o_O('Post', function() {});
      var post1 = Post.initialize({title: 'Cat dead', body: "She's totally done. Fo sure."})
      var post2 = Post.initialize({title: 'Dog dead', body: "She's totally done. Fo sure."})
      
      var posts = o_O('PostsBucket', [post1])
      o_O.render('test', posts, '#test-ul', '<li/>')
      posts.add(post2);
      
      setTimeout(function() {
        equals($('#test-ul').html(), "<li>Cat dead: She's totally done. Fo sure.</li><li>Dog dead: She's totally done. Fo sure.</li>")
        start()
      }, 100)
    })
    
    asyncTest('can deal with modified objects in a multi element bound bucket', 1, function() {
      $('#test-ul').html('')
      var model = o_O('Post', function() {});
      var post1 = Post.initialize({title: 'Cat dead', body: "She's totally done. Fo sure."})
      var post2 = Post.initialize({title: 'Dog dead', body: "She's totally done. Fo sure."})
      
      var posts = o_O('PostsBucket', [post1, post2])
      o_O.render('test', posts, '#test-ul', '<li/>')
      post2('title', 'Hedgehog dead');
    
      setTimeout(function() {
        equals($('#test-ul').html(), "<li>Cat dead: She's totally done. Fo sure.</li><li>Hedgehog dead: She's totally done. Fo sure.</li>")
        start()
      }, 10)
    })
    
    // asyncTest('form can be bound to a bucket', function() {
    //   var model = o_O('Post', function() {});
    //   var posts = o_O('PostsBucket')
    //   o_O.bind_form(posts, Post, '#test-form')
    //   $('#test-form :input[name=title]').val('bla')
    //   $('#test-form :input[name=content]').val('blub')
    //   $('#test-form').submit()
    //   
    //   equals(posts.size(), 1)
    //   var post = posts.get(0);
    //   equals(post('title'), 'bla')
    //   equals(post('content'), 'blub')
    //   
    //   $('#test-form :input[name=title]').val('bla2')
    //   $('#test-form :input[name=content]').val('blub2')
    //   $('#test-form').submit()
    //   
    //   equals(posts.size(), 2)
    //   var post = posts.get(0);
    //   equals(post('title'), 'bla')
    //   equals(post('content'), 'blub')
    //   var post = posts.get(1);
    //   equals(post('title'), 'bla2')
    //   equals(post('content'), 'blub2')
    // })

  });
  </script>
  
</head>
<body>
  <h1 id="qunit-header">DOM Tests</h1>
  <h2 id="qunit-banner"></h2>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  
  <div data-id="big-whoop" data-model="Review">
    <h1 data-attribute="title">Whoop!</h1>
    <p data-attribute="content">Awesome!</p>
  </div>
  
  <div id="test-container"></div>
  <ul id="test-ul"></ul>
  <form id="test-form"><input type="hidden" name="title" /><input type="hidden" name="body" /></form>
</body>
</html>